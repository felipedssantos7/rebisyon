<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>ðŸ“š Rebisyon</title>
  <link rel="stylesheet" href="css/globals.css">
  <link rel="stylesheet" href="css/index.css">
</head>

<body onload="onLoadBody();">
  <div id="content">
    <div id="navbar">
      <div id="logo">ðŸ“š Rebisyon</div>
      <div id="menu">
        <div class="item selected">Baralhos</div>
        <div class="item">Adicionar</div>
        <div class="item">Painel</div>
        <div class="item">EstatÃ­sticas</div>
        <div class="item"><a href="pages/test.html">Sincronizar</a></div>
      </div>
    </div>
    <div id="body">
      <table id="decks-table"></table>
      <div id="info">
        <div id="total">
          <div>
            <b>Total de cartÃµes novos:</b>
            <span id="total-of-news">0</span>
          </div>
          <div>
            <b>Total de cartÃµes para rever:</b>
            <span id="total-to-review">0</span>
          </div>
        </div>
        <div>VocÃª estudou 0 cartÃ£o(Ãµes) em 0 segundo(s) hoje.</div>
      </div>
    </div>
    <div id="footer">
      <button>Obter baralho compartilhado</button>
      <button id="add-deck">Criar novo baralho</button>
      <button>Importar arquivo</button>
    </div>
  </div>
</body>
<script src="js/index.js"></script>
<script src="js/db.js"></script>
<script>
  // Get ipc.
  const { ipcRenderer } = require("electron");

  // Request decks list from database.
  function getDecks() {
    ipcRenderer.send("requestGetDecks");
  }

  // Receive decks list from database.
  ipcRenderer.on("receiveGetDecks", (event, rows) => {
    buildTbody(rows, getCardsNumber, getCardsNumber);
  });

  function getCardsNumber(deckId, state) {
    ipcRenderer.send("requestGetCardsNumber", deckId, state);
  }

  ipcRenderer.on("receiveGetCardsNumber", (event, state, rows) => {
    if (state == "New") {
      for(var i = 0; i < rows.length; i++) {
        var tr = document.getElementById("row_" + rows[i].idDeckFK);
        var td = tr.children[1];
        var span = td.children[0];
        span.textContent = rows[i].count;
      }
    } else if (state == "Re-study") {
      for(var i = 0; i < rows.length; i++) {
        var tr = document.getElementById("row_" + rows[i].idDeckFK);
        var td = tr.children[2];
        var span = td.children[0];
        span.textContent = rows[i].count;
      }
    } else if (state == "Review") {
      for(var i = 0; i < rows.length; i++) {
        var tr = document.getElementById("row_" + rows[i].idDeckFK);
        var td = tr.children[3];
        var span = td.children[0];
        span.textContent = rows[i].count;
      }
    }
  });

  // Request deck add in the db.
  document.querySelector("#add-deck").addEventListener("click", (event) => {
    event.preventDefault();
    var name = "Baralho de teste";
    ipcRenderer.send("requestAddDeck", name);
  });

  // Receive deck add return.
  ipcRenderer.on("receiveAddDeck", (event, row) => addRow(row));

  // Request remove deck fom database.
  function rmDeck(deckId) {
      ipcRenderer.send("requestRmDeck", deckId);
  };

  // Receive remove deck return.
  ipcRenderer.on("receiveRmDeck", (event, id) => rmRow(id));


</script>

</html>